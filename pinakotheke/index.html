<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Chamber-specific meta -->
    <title>PINAKOTHEKE | ET CETER4</title>
    <meta name="description" content="Photography, digital art, glitch, and generative visual works" />
    <meta name="author" content="ET CETER4" />

    <!-- Open Graph -->
    <meta property="og:title" content="PINAKOTHEKE | ET CETER4" />
    <meta property="og:description" content="Photography, digital art, glitch, and generative visual works" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="ET CETER4" />

    <!-- CSS -->
    <link rel="stylesheet" href="../css/vendor/tachyons/css/tachyons.min.css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/chamber-colors.css" />
    <link rel="stylesheet" href="css/pinakotheke.css" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../img/favicon.ico" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#FF00FF" />
  </head>

  <body class="min-vh-100 w-100 futura fw1 pinakotheke-chamber">
    <!-- Skip to main content link for accessibility -->
    <a href="#chamber-content" class="skip-link" aria-label="Skip to main content">Skip to main content</a>

    <!-- Chamber Header -->
    <header class="chamber-header fixed top-0 left-0 w-100 z-5 pa3" style="background: rgba(0, 0, 0, 0.8)">
      <nav class="flex justify-between items-center mw9 center" aria-label="Chamber navigation">
        <a href="../index.html#menu" class="chamber-back-btn white f6 link flex items-center">
          <span class="mr2">&larr;</span>
          <span>Back to Naos</span>
        </a>
        <h1 class="ma0 f4 tracked-mega" style="color: #ff00ff">PINAKOTHEKE</h1>
        <div class="chamber-nav-spacer w4"></div>
      </nav>
    </header>

    <!-- Main Content Area -->
    <main id="chamber-content" class="pt5 pb5 min-vh-100" role="main" aria-label="PINAKOTHEKE content">
      <!-- Chamber Hero Section -->
      <section
        class="chamber-hero pinakotheke vh-50 flex flex-column justify-center items-center tc"
        style="background: linear-gradient(180deg, rgba(255, 0, 255, 0.2) 0%, transparent 100%)"
      >
        <h2 class="f-headline-ns f1 tracked-mega ma0 mb3 pinakotheke-text">PINAKOTHEKE</h2>
        <p class="bodoni f4 o-80 mw6 ph4">Photography, digital art, glitch, generative</p>
      </section>

      <!-- Content Grid -->
      <section id="chamber-grid" class="mw9 center ph4 pv5">
        <!-- Section Navigation -->
        <div class="chamber-section-nav flex flex-wrap justify-center mb5 gap3">
          <button class="section-nav-btn active" data-section="all" style="border-color: #ff00ff; color: #ff00ff">
            ALL
          </button>
          <button class="section-nav-btn" data-section="photography" style="border-color: #ff00ff; color: #ff00ff">
            PHOTOGRAPHY
          </button>
          <button class="section-nav-btn" data-section="digital" style="border-color: #ff00ff; color: #ff00ff">
            DIGITAL
          </button>
          <button class="section-nav-btn" data-section="glitch" style="border-color: #ff00ff; color: #ff00ff">
            GLITCH
          </button>
          <button class="section-nav-btn" data-section="generative" style="border-color: #ff00ff; color: #ff00ff">
            GENERATIVE
          </button>
        </div>

        <!-- Gallery Grid -->
        <div id="chamber-items" class="gallery-grid">
          <!-- Items will be populated from config.js -->
        </div>
      </section>
    </main>

    <!-- Lightbox Overlay -->
    <div
      id="gallery-lightbox"
      class="lightbox-overlay"
      role="dialog"
      aria-modal="true"
      aria-label="Image viewer"
      style="display: none"
    >
      <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
      <button class="lightbox-prev" aria-label="Previous image">&larr;</button>
      <div class="lightbox-content">
        <img id="lightbox-image" src="" alt="" />
        <div class="lightbox-spinner"></div>
      </div>
      <button class="lightbox-next" aria-label="Next image">&rarr;</button>
      <div class="lightbox-info">
        <h3 id="lightbox-title"></h3>
        <p id="lightbox-category"></p>
        <p id="lightbox-description"></p>
        <span id="lightbox-counter" class="lightbox-counter"></span>
      </div>
    </div>

    <!-- Chamber Footer -->
    <footer class="chamber-footer fixed bottom-0 w-100 pa3 bg-black-90" role="contentinfo">
      <nav class="flex justify-center items-center" aria-label="Footer navigation">
        <a href="../index.html#landing" class="white-70 f7 link mh3">ETCETER4</a>
        <span class="white-30">//</span>
        <a href="../index.html#menu" class="white-70 f7 link mh3">NAOS</a>
        <span class="white-30">//</span>
        <a href="../sitemap.html" class="white-70 f7 link mh3">SITE MAP</a>
      </nav>
    </footer>

    <!-- Scripts -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/velocity/2.0.6/velocity.min.js"
      integrity="sha512-+ZPnKPFqf/PjXPKJLBykOgAOnUmCp0ufqCYWsuvMV5FhlYCf/DlTdB3PQJuXzA3otXm1FiooUNrBncLRLbYaxA=="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" src="../js/config.js"></script>
    <script type="text/javascript" src="../js/living-pantheon/LivingPantheonCore.js"></script>
    <script type="text/javascript" src="config.js"></script>
    <script>
      'use strict';

      /**
       * PinakothekeChamber - Gallery chamber controller with lightbox
       */
      const PinakothekeChamber = (function () {
        let currentItems = [];
        let currentIndex = 0;
        let lightboxOpen = false;

        // DOM references
        const elements = {};

        /**
         * Initialize the chamber
         */
        function initialize() {
          cacheElements();
          setupEventListeners();
          renderGallery(PINAKOTHEKE_CONFIG.items || []);
          initializeLivingPantheon();
        }

        /**
         * Cache DOM elements
         */
        function cacheElements() {
          elements.gallery = document.getElementById('chamber-items');
          elements.sectionBtns = document.querySelectorAll('.section-nav-btn');
          elements.lightbox = document.getElementById('gallery-lightbox');
          elements.lightboxImage = document.getElementById('lightbox-image');
          elements.lightboxTitle = document.getElementById('lightbox-title');
          elements.lightboxCategory = document.getElementById('lightbox-category');
          elements.lightboxDescription = document.getElementById('lightbox-description');
          elements.lightboxCounter = document.getElementById('lightbox-counter');
          elements.closeBtn = elements.lightbox?.querySelector('.lightbox-close');
          elements.prevBtn = elements.lightbox?.querySelector('.lightbox-prev');
          elements.nextBtn = elements.lightbox?.querySelector('.lightbox-next');
        }

        /**
         * Setup all event listeners
         */
        function setupEventListeners() {
          // Section navigation
          elements.sectionBtns.forEach(btn => {
            btn.addEventListener('click', handleSectionClick);
          });

          // Lightbox controls
          if (elements.closeBtn) {
            elements.closeBtn.addEventListener('click', closeLightbox);
          }
          if (elements.prevBtn) {
            elements.prevBtn.addEventListener('click', showPrevImage);
          }
          if (elements.nextBtn) {
            elements.nextBtn.addEventListener('click', showNextImage);
          }

          // Click outside to close
          if (elements.lightbox) {
            elements.lightbox.addEventListener('click', function (e) {
              if (e.target === elements.lightbox || e.target.classList.contains('lightbox-content')) {
                closeLightbox();
              }
            });
          }

          // Keyboard navigation
          document.addEventListener('keydown', handleKeydown);
        }

        /**
         * Handle section button click
         */
        function handleSectionClick() {
          const section = this.dataset.section;

          elements.sectionBtns.forEach(b => b.classList.remove('active'));
          this.classList.add('active');

          const allItems = PINAKOTHEKE_CONFIG.items || [];
          const filtered = section === 'all' ? allItems : allItems.filter(item => item.section === section);

          renderGallery(filtered);
        }

        /**
         * Render gallery items
         */
        function renderGallery(items) {
          currentItems = items;

          if (!elements.gallery) {
            return;
          }

          if (items.length === 0) {
            elements.gallery.innerHTML = `
              <div class="tc pa5 w-100">
                <p class="f5 pinakotheke-text">No items in this collection</p>
              </div>
            `;
            return;
          }

          elements.gallery.innerHTML = items.map((item, index) => createGalleryItem(item, index)).join('');
          attachGalleryListeners();
        }

        /**
         * Create gallery item HTML
         */
        function createGalleryItem(item, index) {
          return `
            <div class="gallery-item ${item.section || 'all'}" data-index="${index}" tabindex="0" role="button" aria-label="View ${escapeHtml(item.title)}">
              <div class="gallery-item-wrapper">
                <img src="${escapeHtml(item.thumbnail || item.image)}" alt="${escapeHtml(item.title)}" loading="lazy" />
                <div class="gallery-overlay">
                  <h3 class="f5 tracked mb2">${escapeHtml(item.title)}</h3>
                  <p class="f7 o-80">${escapeHtml(item.category)}</p>
                </div>
              </div>
            </div>
          `;
        }

        /**
         * Attach click listeners to gallery items
         */
        function attachGalleryListeners() {
          elements.gallery.querySelectorAll('.gallery-item').forEach(item => {
            item.addEventListener('click', function () {
              const index = parseInt(this.dataset.index, 10);
              openLightbox(index);
            });
            item.addEventListener('keypress', function (e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                const index = parseInt(this.dataset.index, 10);
                openLightbox(index);
              }
            });
          });
        }

        /**
         * Open lightbox at specific index
         */
        function openLightbox(index) {
          if (!elements.lightbox || currentItems.length === 0) {
            return;
          }

          currentIndex = index;
          lightboxOpen = true;
          elements.lightbox.style.display = 'flex';
          document.body.style.overflow = 'hidden';

          updateLightboxContent();

          // Focus trap
          elements.closeBtn?.focus();
        }

        /**
         * Close lightbox
         */
        function closeLightbox() {
          if (!elements.lightbox) {
            return;
          }

          lightboxOpen = false;
          elements.lightbox.style.display = 'none';
          document.body.style.overflow = '';

          // Return focus to the gallery item
          const item = elements.gallery?.querySelector(`[data-index="${currentIndex}"]`);
          item?.focus();
        }

        /**
         * Show previous image
         */
        function showPrevImage() {
          if (currentItems.length === 0) {
            return;
          }
          currentIndex = (currentIndex - 1 + currentItems.length) % currentItems.length;
          updateLightboxContent();
        }

        /**
         * Show next image
         */
        function showNextImage() {
          if (currentItems.length === 0) {
            return;
          }
          currentIndex = (currentIndex + 1) % currentItems.length;
          updateLightboxContent();
        }

        /**
         * Update lightbox content for current index
         */
        function updateLightboxContent() {
          const item = currentItems[currentIndex];
          if (!item) {
            return;
          }

          // Show loading state
          elements.lightboxImage.style.opacity = '0.5';

          // Update image
          const fullImage = item.fullImage || item.image;
          elements.lightboxImage.onload = function () {
            elements.lightboxImage.style.opacity = '1';
          };
          elements.lightboxImage.src = fullImage;
          elements.lightboxImage.alt = item.title;

          // Update info
          if (elements.lightboxTitle) {
            elements.lightboxTitle.textContent = item.title;
          }
          if (elements.lightboxCategory) {
            elements.lightboxCategory.textContent = item.category || '';
          }
          if (elements.lightboxDescription) {
            elements.lightboxDescription.textContent = item.description || '';
          }
          if (elements.lightboxCounter) {
            elements.lightboxCounter.textContent = `${currentIndex + 1} / ${currentItems.length}`;
          }

          // Update nav button visibility
          if (elements.prevBtn) {
            elements.prevBtn.style.visibility = currentItems.length > 1 ? 'visible' : 'hidden';
          }
          if (elements.nextBtn) {
            elements.nextBtn.style.visibility = currentItems.length > 1 ? 'visible' : 'hidden';
          }
        }

        /**
         * Handle keyboard navigation
         */
        function handleKeydown(e) {
          if (!lightboxOpen) {
            return;
          }

          switch (e.key) {
            case 'Escape':
              closeLightbox();
              break;
            case 'ArrowLeft':
              e.preventDefault();
              showPrevImage();
              break;
            case 'ArrowRight':
              e.preventDefault();
              showNextImage();
              break;
          }
        }

        /**
         * Escape HTML special characters
         */
        function escapeHtml(str) {
          if (!str) {
            return '';
          }
          const div = document.createElement('div');
          div.textContent = str;
          return div.innerHTML;
        }

        /**
         * Initialize Living Pantheon
         */
        function initializeLivingPantheon() {
          if (typeof LivingPantheonCore !== 'undefined' && ETCETER4_CONFIG.livingPantheon?.enabled) {
            LivingPantheonCore.getInstance()
              .initialize({
                chamberId: 'pinakotheke',
                chamberColor: '#FF00FF',
              })
              .start();
          }
        }

        return {
          initialize,
          openLightbox,
          closeLightbox,
        };
      })();

      // Initialize on DOM ready
      document.addEventListener('DOMContentLoaded', function () {
        PinakothekeChamber.initialize();
      });
    </script>
  </body>
</html>
